<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PheMPOlive · Predicción temprana y sostenible de cosecha</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<style>
  :root{
    --ink:#1a2433; --muted:#5e6a52; --brand:#405a34; --brand-2:#6f8a3a;
    --bg:#f3f6ef; --card:#ffffff; --border:#dfe8cf;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.6}
  .container{max-width:1100px;margin:0 auto;padding:28px 16px}
  h1,h2{line-height:1.25;margin:0 0 16px}
  h1{font-size:clamp(1.6rem,2.4vw,2.1rem)}
  h2{font-size:clamp(1.2rem,2.1vw,1.6rem)}
  p{margin:0 0 12px}
  .hero{background:linear-gradient(180deg,#f8faf4,#eef3e5);border-bottom:1px solid var(--border)}
  .hero-inner{display:flex;gap:24px;align-items:center;justify-content:space-between}
  .logo-main{height:86px}
  .logo-uco{height:70px}
  .logo-funders{height:58px}
  @media (max-width:860px){.hero-inner{flex-direction:column;gap:12px}.logo-main{height:76px}.logo-uco{height:64px}.logo-funders{height:52px}}
  .section{padding-block:28px}
  .grid-2{display:grid;grid-template-columns:1.2fr 1fr;gap:24px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
  figure{margin:0}
  figcaption{font-size:.9rem;color:var(--muted);margin-top:6px}
  a{color:var(--brand)}
  .logos-inline{display:flex;flex-wrap:wrap;gap:14px;align-items:center}
  .logos-inline img{height:40px}
  .pillars{display:grid;grid-template-columns:1fr 1fr;gap:8px 24px;padding-left:18px}
  .source{font-size:.9rem;color:var(--muted)}
</style>
</head>
<body>
  <header class="hero">
    <div class="container hero-inner">
      <img src="images/PheMPolive.png" alt="PheMPOlive" class="logo-main"/>
      <img src="images/Logounicordoba.png" alt="Universidad de Córdoba" class="logo-uco"/>
      <img src="images/ack-micin-cofinanciado-ue-ae.png" alt="Financiación MICIU – Cofinanciado UE – AEI" class="logo-funders"/>
    </div>
  </header>

  <main class="container">
    <!-- Introducción -->
    <section class="section" id="intro">
      <h1>PheMPOlive (PID2023‑152718OA‑I00)</h1>
      <p><strong>Modelización fenológica y automatización del muestreo polínico para una predicción temprana y sostenible de la producción de aceite de oliva.</strong></p>
      <div class="grid-2">
        <div>
          <p><strong>Objetivo.</strong> Integrar <em>fenología</em>, <em>aerobiología</em>, <em>clima regionalizado</em> y <em>automatización</em> para anticipar la cosecha en cuatro escalas (almazara, provincia, Andalucía y España), con dos cortes de predicción (julio y noviembre).</p>
          <p><strong>Razonamiento.</strong> El polen atmosférico resume la intensidad de floración a gran escala y, al acoplarse con el estado fenológico y los extremos climáticos, permite estimaciones robustas de rendimiento. La red automática valida y acelera este flujo de información.</p>
          <p><strong>Equipo UCO.</strong> IP: Jose Oteros. Miembros: Carmen Galán Soldevilla, Purificación Alcázar Teno. Equipo de trabajo: Carmen García Llamas, Moisés Martínez‑Bracero, Rocío López‑Orozco, Herminia García‑Mozo.</p>
        </div>
        <figure>
          <img src="images/draft projecto.png" alt="Esquema del proyecto" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
          <figcaption>Esquema general: 1) Fenología, 2) Aerobiología, 3) Clima, 4) Modelos, 5) Automatización, 6) Plataforma.</figcaption>
        </figure>
      </div>
    </section>

    <!-- 1. Modelos de predicción de cosecha -->
    <section class="section" id="harvest-models">
      <h2>1) Modelos de predicción de cosecha</h2>
      <div class="grid-2">
        <div>
          <p>Se implementa un <strong>ensamblado</strong> de métodos (regresión aditiva, Random Forest, SVM, redes neuronales y PLS) con tres familias de predictores: (a) <em>indicadores polínicos</em> (intensidad, umbrales, fechas de inicio/pico/fin), (b) <em>ventanas meteorológicas</em> críticas (agua y temperatura, especialmente en cuajado/lipogénesis) y (c) <em>estado fenológico</em> regionalizado.</p>
          <p>La relación entre polen y producción está documentada por el Grupo RNM‑130 y se consolidó en el modelo de índices para el olivar <span title="Oteros et al., 2014">(Oteros et al., 2014; DOI 10.1007/s13593-013-0198-x)</span>.</p>
          <figure>
            <img src="images/Enfoque predictivo.png" alt="Enfoque predictivo" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
            <figcaption>Arquitectura del sistema de predicción y fuentes de predictores.</figcaption>
          </figure>
        </div>
        <figure>
          <img src="images/gradiente ambiental de olivares.png" alt="Gradiente ambiental de olivares" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
          <figcaption>Distribución de olivares y gradientes ambientales usados en la regionalización.</figcaption>
        </figure>
      </div>
      <div class="card" style="margin-top:12px">
        <h3>Serie histórica de producción · Andalucía vs España</h3>
        <canvas id="cropSeries" height="120"></canvas>
        <p class="source">Fuente: Anuarios de Estadística Agraria (Ministerio de Agricultura, Pesca y Alimentación) y Junta de Andalucía.</p>
      </div>
    </section>

    <!-- 2. Modelo fenológico -->
    <section class="section" id="phenology">
      <h2>2) Modelo fenológico</h2>
      <div class="grid-2">
        <div>
          <p>Se emplea <strong>PhenoFlex</strong> (acumulación de frío + calor con transición sigmoidal) y un banco comparativo de 21 métodos (paquete <em>phenoR</em>) para seleccionar el mejor desempeño (MAE/RMSE). La validación se realiza con series largas de la provincia de Córdoba y la regionalización sobre la superficie de olivar a 0.1°.</p>
          <p>La imagen de <em>floración</em> de <em>Olea europaea</em> sirve como referencia visual de las fases BBCH. El <strong>seguimiento semanal de fenología</strong> combina visitas de campo y material fotográfico estandarizado.</p>
        </div>
        <figure>
          <img src="images/floracion.jpg" alt="Floración de olivo" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
          <figcaption>Fases BBCH durante la floración.</figcaption>
        </figure>
      </div>
      <div class="grid-2" style="margin-top:10px">
        <figure>
          <img src="images/feno de campo.png" alt="Seguimiento semanal de fenología" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
          <figcaption>Seguimiento semanal de fenología en olivares de Córdoba.</figcaption>
        </figure>
        <figure>
          <img src="images/Imagen6.gif" alt="Progresión espacial de fases" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
          <figcaption>Progresión espacial de fases (animación).</figcaption>
        </figure>
      </div>
    </section>

    <!-- 3. Polen semanal -->
    <section class="section" id="pollen-weekly">
      <h2>3) Polen de olivo (semanal)</h2>
      <p>El polen de <em>Olea</em> es un <strong>bioindicador directo</strong> de la intensidad de floración a escala regional. Aquí se muestran medias semanales de la concentración atmosférica registradas en la provincia de Córdoba; estos indicadores alimentan los modelos de cosecha y permiten estimaciones tempranas.</p>
      <div class="card">
        <canvas id="pollenWeekly" height="120"></canvas>
        <p class="source">Datos RNM‑130/UCO (red provincial de captadores Hirst y estaciones automáticas en transición).</p>
      </div>
    </section>

    <!-- 4. EBAS / SYLVA real time -->
    <section class="section" id="ebas">
      <h2>4) Datos de polen en tiempo real (EBAS) · <span style="color:var(--brand)">SYLVA</span></h2>
      <div class="grid-2">
        <div>
          <p>Los datos en <strong>tiempo real</strong> proceden de <strong>SYLVA</strong>, que ha permitido la <strong>automatización del muestreo</strong> en el sur del Mediterráneo y la generación de <em>librerías de entrenamiento</em> para distintos dispositivos (BAA500, Swisens Poleno Jupiter y PollenSense), incluyendo especies clave como el <em>olivo</em>. Acceso mediante <a href="https://ebas-data.nilu.no/" target="_blank" rel="noopener">EBAS (NILU)</a>. Conjuntos de referencia: <a href="https://data.sylva.bioaerosol.eu/" target="_blank" rel="noopener">data.sylva.bioaerosol.eu</a>.</p>
          <div class="logos-inline" style="margin-top:10px">
            <img src="images/LogoEBAS.png" alt="EBAS"/>
            <img src="images/SYLVA-sylva.png" alt="SYLVA"/>
            <img src="images/EU_funded_horizontal_pos.svg" alt="Funded by the European Union"/>
            <img src="images/SERI_funded_horizontal_pos.svg" alt="Supported by SERI (Switzerland)"/>
          </div>
        </div>
        <figure>
          <img src="images/dispositivos automáticos.png" alt="Dispositivos automáticos" style="width:100%;border-radius:14px;border:1px solid var(--border)"/>
          <figcaption>Principales dispositivos automáticos empleados/validados en SYLVA.</figcaption>
        </figure>
      </div>
    </section>

    <!-- 5. Componentes del proyecto -->
    <section class="section" id="pillars">
      <h2>5) Componentes del proyecto</h2>
      <ol class="pillars">
        <li><strong>Fenología</strong>: modelización PhenoFlex y comparación de métodos; regionalización sobre superficie de olivar.</li>
        <li><strong>Aerobiología</strong>: parámetros de estación polínica (intensidad, duración, picos, umbrales) y homogeneización con automáticos.</li>
        <li><strong>Meteorología</strong>: clima regionalizado (ECA&D/Copernicus) y extremos en ventanas críticas.</li>
        <li><strong>Modelos de cosecha</strong>: ensamblado multi‑modelo (predicciones en julio y noviembre) con distribución de probabilidad.</li>
        <li><strong>Automatización & plataforma</strong>: red automática, integración EBAS y portal de información para el sector.</li>
      </ol>
    </section>
  </main>

  <footer class="hero">
    <div class="container" style="text-align:center">
      <p><strong>PheMPOlive</strong> — Universidad de Córdoba · PID2023‑152718OA‑I00.</p>
    </div>
  </footer>

  <!-- Librerías -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
  // -------- utilidades --------
  const norm = s => String(s ?? '').trim().toLowerCase();
  const pick = (row, candidates) => {
    for (const n of candidates) if (row[n] != null) return row[n];
    const keys = Object.keys(row);
    for (const k of keys) if (candidates.map(norm).includes(norm(k))) return row[k];
    return null;
  };
  const toNum = v => (v == null || v === '') ? null : Number(v);
  async function fetchXLSX(url){
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error('No se pudo leer ' + url);
    const buf = await res.arrayBuffer();
    return XLSX.read(buf, {type:'array'});
  }

  // -------- 1) Cosecha: Andalucía vs España --------
  (async () => {
    try {
      const wb = await fetchXLSX('data/Crop_Anuarios_JA.xlsx');
      // intenta hoja 'Crop'; si no, primera
      const ws = wb.Sheets['Crop'] || wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, {defval:null});

      const labels = [], andal = [], spain = [];
      for (const r of rows) {
        const year = pick(r, ['Year','Año','Anio']);
        const and  = pick(r, ['Andalusia','Andalucía','And','Crop_And']);
        const es   = pick(r, ['Spain','España','ES','Crop_Spain']);
        if (year != null) {
          labels.push(String(year));
          andal.push(toNum(and));
          spain.push(toNum(es));
        }
      }

      new Chart(document.getElementById('chartCrop'), {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Andalucía (t aceituna)', data: andal, tension: .25 },
            { label: 'España (t aceituna)',    data: spain, tension: .25 }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'bottom' } },
          interaction: { mode: 'index', intersect: false }
        }
      });
    } catch(e) { console.error('Cosecha (XLSX):', e); }
  })();

  // -------- 3) Polen (media semanal) --------
  (async () => {
    try {
      const wb = await fetchXLSX('data/UCO_Pollen_OLEA_2425.xlsx');
      const ws = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, {defval:null});

      let labels = [], values = [];

      // Caso A: ya viene agregado con Week / Mean
      const hasWeekMean = rows.length &&
                          (('Week' in rows[0]) || ('week' in rows[0])) &&
                          (('Mean' in rows[0]) || ('mean' in rows[0]));

      if (hasWeekMean) {
        for (const r of rows) {
          labels.push(String(pick(r, ['Week','week'])));
          values.push(toNum(pick(r, ['Mean','mean'])));
        }
      } else {
        // Caso B: datos diarios -> agregamos media semanal por lunes
        const byWeek = new Map();
        for (const r of rows) {
          const dRaw = pick(r, ['Date','date','Fecha']);
          const val  = toNum(pick(r, ['Olea','olea','OLEA','Olea_avg']));
          if (!dRaw || val == null) continue;

          const d = new Date(dRaw);
          const dow = (d.getUTCDay() + 6) % 7; // lunes=0
          const wk = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() - dow));
          const key = wk.toISOString().slice(0,10);

          if (!byWeek.has(key)) byWeek.set(key, {sum:0, n:0});
          const acc = byWeek.get(key); acc.sum += val; acc.n += 1;
        }
        const keys = Array.from(byWeek.keys()).sort();
        labels = keys;
        values = keys.map(k => +(byWeek.get(k).sum / byWeek.get(k).n).toFixed(2));
      }

      new Chart(document.getElementById('chartPollen'), {
        type: 'bar',
        data: { labels, datasets: [{ label: 'Olea (granos·m⁻³, media semanal)', data: values }] },
        options: {
          responsive: true,
          scales: { x: { grid: { color: '#22306422' } }, y: { grid: { color: '#22306422' } } }
        }
      });
    } catch(e) { console.error('Pollen (XLSX):', e); }
  })();

  // Año footer
  const yyEl = document.getElementById('yy'); if (yyEl) yyEl.textContent = new Date().getFullYear();
</script>
</body>
</html>
